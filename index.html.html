<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CyberSafe SME â€” Free AI Cyber Risk Report</title>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,wght@0,300;0,600;0,900;1,300&family=DM+Mono:wght@400;500&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet"/>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --ink: #0c0e12;
      --ink2: #161b25;
      --ink3: #1e2535;
      --slate: #2d3748;
      --steel: #94a3b8;
      --mist: #cbd5e1;
      --paper: #f8fafc;
      --white: #ffffff;
      --gold: #d4a843;
      --gold-light: #f0c96a;
      --teal: #0d9488;
      --teal-light: #2dd4bf;
      --red: #dc2626;
      --amber: #d97706;
      --green: #059669;
      --blue: #2563eb;
    }

    html { scroll-behavior: smooth; }

    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--ink);
      color: var(--white);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* grain overlay */
    body::after {
      content: '';
      position: fixed; inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");
      pointer-events: none; z-index: 9999; opacity: 0.5;
    }

    /* â”€â”€ HEADER â”€â”€ */
    header {
      padding: 1.4rem 5%;
      display: flex; align-items: center; justify-content: space-between;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      position: sticky; top: 0; z-index: 100;
      background: rgba(12,14,18,0.9);
      backdrop-filter: blur(20px);
    }

    .logo {
      font-family: 'Fraunces', serif;
      font-weight: 900;
      font-size: 1.3rem;
      letter-spacing: -0.03em;
      display: flex; align-items: center; gap: 0.7rem;
    }

    .logo-shield {
      width: 34px; height: 34px;
      background: linear-gradient(145deg, var(--gold), var(--teal));
      border-radius: 8px;
      display: grid; place-items: center;
      font-size: 1rem;
    }

    .logo span { color: var(--gold); }

    .header-badge {
      font-size: 0.75rem; font-weight: 600;
      letter-spacing: 0.08em; text-transform: uppercase;
      color: var(--teal-light);
      border: 1px solid rgba(13,148,136,0.35);
      padding: 0.3rem 0.8rem; border-radius: 100px;
      background: rgba(13,148,136,0.08);
    }

    /* â”€â”€ HERO â”€â”€ */
    .hero {
      padding: 5rem 5% 4rem;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .hero::before {
      content: '';
      position: absolute;
      width: 600px; height: 600px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(212,168,67,0.08) 0%, transparent 65%);
      top: -100px; left: 50%; transform: translateX(-50%);
      pointer-events: none;
    }

    .hero-eyebrow {
      display: inline-flex; align-items: center; gap: 0.5rem;
      font-family: 'DM Mono', monospace;
      font-size: 0.72rem; letter-spacing: 0.14em; text-transform: uppercase;
      color: var(--gold);
      margin-bottom: 1.8rem;
      animation: fadeUp 0.5s ease both;
    }

    .hero-eyebrow::before, .hero-eyebrow::after {
      content: 'â€”';
      color: rgba(212,168,67,0.4);
    }

    .hero h1 {
      font-family: 'Fraunces', serif;
      font-size: clamp(2.5rem, 6vw, 4.5rem);
      font-weight: 900;
      letter-spacing: -0.04em;
      line-height: 1.05;
      margin-bottom: 1.4rem;
      animation: fadeUp 0.5s 0.1s ease both;
    }

    .hero h1 em {
      font-style: italic;
      font-weight: 300;
      color: var(--gold-light);
    }

    .hero-sub {
      font-size: 1.05rem; font-weight: 300;
      color: var(--steel);
      max-width: 520px; margin: 0 auto 2.5rem;
      line-height: 1.75;
      animation: fadeUp 0.5s 0.15s ease both;
    }

    .hero-pills {
      display: flex; flex-wrap: wrap; gap: 0.6rem;
      justify-content: center; margin-bottom: 3rem;
      animation: fadeUp 0.5s 0.2s ease both;
    }

    .pill {
      font-size: 0.78rem; font-weight: 500;
      padding: 0.35rem 0.9rem; border-radius: 100px;
      border: 1px solid rgba(255,255,255,0.1);
      color: var(--mist); background: rgba(255,255,255,0.04);
    }

    /* â”€â”€ MAIN TOOL CARD â”€â”€ */
    .tool-wrap {
      max-width: 820px;
      margin: 0 auto;
      padding: 0 5% 6rem;
    }

    .tool-card {
      background: var(--ink2);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 40px 80px rgba(0,0,0,0.5);
    }

    /* step indicator */
    .step-bar {
      display: flex;
      background: var(--ink3);
      border-bottom: 1px solid rgba(255,255,255,0.06);
      padding: 0 2rem;
    }

    .step-item {
      flex: 1; padding: 1rem 0.5rem;
      display: flex; flex-direction: column; align-items: center; gap: 0.3rem;
      font-family: 'DM Mono', monospace;
      font-size: 0.65rem; letter-spacing: 0.08em; text-transform: uppercase;
      color: rgba(255,255,255,0.25);
      border-bottom: 2px solid transparent;
      transition: all 0.3s;
      cursor: default;
    }

    .step-item.active { color: var(--gold); border-bottom-color: var(--gold); }
    .step-item.done { color: var(--teal-light); border-bottom-color: var(--teal); }

    .step-dot {
      width: 24px; height: 24px; border-radius: 50%;
      background: rgba(255,255,255,0.06);
      display: grid; place-items: center;
      font-size: 0.7rem; font-weight: 600;
      transition: all 0.3s;
    }

    .step-item.active .step-dot { background: var(--gold); color: var(--ink); }
    .step-item.done .step-dot { background: var(--teal); color: var(--white); }

    .tool-body { padding: 2.5rem; }

    /* â”€â”€ SETUP STEP â”€â”€ */
    .setup-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .field-group { display: flex; flex-direction: column; gap: 0.5rem; }

    .field-label {
      font-family: 'DM Mono', monospace;
      font-size: 0.68rem; font-weight: 500;
      letter-spacing: 0.1em; text-transform: uppercase;
      color: var(--steel);
    }

    .field-select, .field-input {
      width: 100%;
      background: var(--ink3);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      color: var(--white);
      font-family: 'DM Sans', sans-serif;
      font-size: 0.92rem;
      padding: 0.75rem 1rem;
      outline: none;
      transition: border-color 0.2s;
      appearance: none;
      -webkit-appearance: none;
      cursor: pointer;
    }

    .field-select:focus, .field-input:focus { border-color: var(--gold); }
    .field-select option { background: var(--ink3); }

    .select-wrap { position: relative; }
    .select-wrap::after {
      content: 'â–¾';
      position: absolute; right: 1rem; top: 50%; transform: translateY(-50%);
      color: var(--steel); pointer-events: none; font-size: 0.8rem;
    }

    /* â”€â”€ QUESTIONS STEP â”€â”€ */
    .q-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 2rem;
    }

    .q-progress-wrap {
      flex: 1; height: 4px;
      background: rgba(255,255,255,0.07);
      border-radius: 100px; overflow: hidden; margin-left: 1.5rem;
    }

    .q-progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--gold), var(--teal-light));
      border-radius: 100px;
      transition: width 0.4s ease;
    }

    .q-counter {
      font-family: 'DM Mono', monospace;
      font-size: 0.72rem; color: var(--steel);
      white-space: nowrap;
    }

    .q-category {
      font-family: 'DM Mono', monospace;
      font-size: 0.65rem; letter-spacing: 0.1em; text-transform: uppercase;
      color: var(--teal-light); margin-bottom: 0.5rem;
    }

    .q-text {
      font-family: 'Fraunces', serif;
      font-size: 1.2rem; font-weight: 600;
      line-height: 1.4; margin-bottom: 1.6rem;
    }

    .q-options { display: flex; flex-direction: column; gap: 0.7rem; }

    .q-opt {
      display: flex; align-items: flex-start; gap: 1rem;
      padding: 0.95rem 1.1rem;
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.18s;
      background: rgba(255,255,255,0.02);
    }

    .q-opt:hover { border-color: rgba(212,168,67,0.4); background: rgba(212,168,67,0.05); }

    .q-opt.selected {
      border-color: var(--gold);
      background: rgba(212,168,67,0.08);
    }

    .q-opt-indicator {
      width: 20px; height: 20px; border-radius: 50%;
      border: 2px solid rgba(255,255,255,0.2);
      flex-shrink: 0; margin-top: 1px;
      transition: all 0.18s;
      display: grid; place-items: center;
    }

    .q-opt.selected .q-opt-indicator {
      border-color: var(--gold);
      background: var(--gold);
    }

    .q-opt.selected .q-opt-indicator::after {
      content: 'âœ“'; font-size: 0.65rem; color: var(--ink); font-weight: 700;
    }

    .q-opt-text { font-size: 0.9rem; color: var(--mist); line-height: 1.5; }
    .q-opt.selected .q-opt-text { color: var(--white); }

    .q-opt-score {
      margin-left: auto; flex-shrink: 0;
      font-family: 'DM Mono', monospace;
      font-size: 0.65rem; padding: 0.2rem 0.5rem;
      border-radius: 4px;
      background: rgba(255,255,255,0.04);
      color: var(--steel);
      align-self: center;
    }

    /* nav buttons */
    .tool-nav {
      display: flex; justify-content: space-between; align-items: center;
      margin-top: 2rem; padding-top: 1.5rem;
      border-top: 1px solid rgba(255,255,255,0.06);
    }

    .btn {
      display: inline-flex; align-items: center; gap: 0.5rem;
      font-family: 'DM Sans', sans-serif;
      font-size: 0.9rem; font-weight: 600;
      padding: 0.7rem 1.5rem; border-radius: 8px;
      cursor: pointer; transition: all 0.2s; border: none;
    }

    .btn-ghost {
      background: transparent;
      border: 1px solid rgba(255,255,255,0.12);
      color: var(--steel);
    }
    .btn-ghost:hover { border-color: rgba(255,255,255,0.3); color: var(--white); }
    .btn-ghost:disabled { opacity: 0.3; cursor: not-allowed; }

    .btn-gold {
      background: linear-gradient(135deg, var(--gold), #b8861f);
      color: var(--ink);
      box-shadow: 0 4px 20px rgba(212,168,67,0.3);
    }
    .btn-gold:hover { box-shadow: 0 6px 28px rgba(212,168,67,0.45); transform: translateY(-1px); }
    .btn-gold:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }

    .btn-teal {
      background: linear-gradient(135deg, var(--teal), #0a7a72);
      color: var(--white);
      box-shadow: 0 4px 20px rgba(13,148,136,0.3);
    }
    .btn-teal:hover { box-shadow: 0 6px 28px rgba(13,148,136,0.45); transform: translateY(-1px); }

    /* â”€â”€ GENERATING STEP â”€â”€ */
    .generating-wrap {
      text-align: center; padding: 3rem 1rem;
    }

    .gen-spinner {
      width: 64px; height: 64px; border-radius: 50%;
      border: 3px solid rgba(212,168,67,0.15);
      border-top-color: var(--gold);
      animation: spin 1s linear infinite;
      margin: 0 auto 2rem;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .gen-title {
      font-family: 'Fraunces', serif;
      font-size: 1.4rem; font-weight: 600;
      margin-bottom: 0.6rem;
    }

    .gen-sub { font-size: 0.88rem; color: var(--steel); margin-bottom: 2rem; }

    .gen-log {
      font-family: 'DM Mono', monospace;
      font-size: 0.72rem; color: var(--teal-light);
      background: rgba(13,148,136,0.06);
      border: 1px solid rgba(13,148,136,0.15);
      border-radius: 8px; padding: 1rem 1.2rem;
      text-align: left; min-height: 80px;
      line-height: 1.8;
    }

    /* â”€â”€ REPORT STEP â”€â”€ */
    .report-wrap { }

    .report-toolbar {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;
    }

    .report-title-area h2 {
      font-family: 'Fraunces', serif;
      font-size: 1.2rem; font-weight: 600;
    }

    .report-title-area p { font-size: 0.8rem; color: var(--steel); margin-top: 0.2rem; }

    .report-actions { display: flex; gap: 0.7rem; }

    /* score ring */
    .score-section {
      display: grid; grid-template-columns: auto 1fr;
      gap: 2rem; align-items: center;
      background: var(--ink3);
      border-radius: 14px; padding: 1.8rem;
      margin-bottom: 1.5rem;
      border: 1px solid rgba(255,255,255,0.06);
    }

    .score-ring-wrap { position: relative; width: 120px; height: 120px; flex-shrink: 0; }

    .score-ring-wrap svg { transform: rotate(-90deg); }

    .score-ring-bg { fill: none; stroke: rgba(255,255,255,0.07); stroke-width: 8; }
    .score-ring-fill { fill: none; stroke-width: 8; stroke-linecap: round; transition: stroke-dashoffset 1.2s ease; }

    .score-num {
      position: absolute; inset: 0;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
    }

    .score-num-val {
      font-family: 'Fraunces', serif;
      font-size: 2rem; font-weight: 900; line-height: 1;
    }

    .score-num-label {
      font-family: 'DM Mono', monospace;
      font-size: 0.6rem; letter-spacing: 0.08em; text-transform: uppercase;
      color: var(--steel); margin-top: 2px;
    }

    .score-info h3 {
      font-family: 'Fraunces', serif;
      font-size: 1.3rem; font-weight: 700;
      margin-bottom: 0.3rem;
    }

    .score-info p { font-size: 0.88rem; color: var(--steel); line-height: 1.6; }

    .risk-badge {
      display: inline-block;
      font-family: 'DM Mono', monospace;
      font-size: 0.65rem; font-weight: 500;
      letter-spacing: 0.1em; text-transform: uppercase;
      padding: 0.25rem 0.7rem; border-radius: 100px;
      margin-bottom: 0.5rem;
    }

    /* report sections */
    .report-section {
      background: var(--ink3);
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 14px; padding: 1.6rem;
      margin-bottom: 1.2rem;
    }

    .report-section-header {
      display: flex; align-items: center; gap: 0.8rem;
      margin-bottom: 1.2rem;
      padding-bottom: 0.8rem;
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }

    .report-section-icon {
      width: 36px; height: 36px; border-radius: 8px;
      display: grid; place-items: center; font-size: 1rem; flex-shrink: 0;
    }

    .report-section-title {
      font-family: 'Fraunces', serif;
      font-size: 1rem; font-weight: 600;
    }

    .report-section-sub {
      font-size: 0.75rem; color: var(--steel); margin-top: 0.1rem;
    }

    .report-text {
      font-size: 0.88rem; color: var(--mist);
      line-height: 1.75; margin-bottom: 1rem;
    }

    /* action items */
    .action-list { display: flex; flex-direction: column; gap: 0.6rem; }

    .action-item {
      display: flex; gap: 0.8rem; align-items: flex-start;
      padding: 0.8rem 1rem;
      border-radius: 8px;
      border-left: 3px solid;
      background: rgba(255,255,255,0.02);
    }

    .action-item.critical { border-left-color: var(--red); }
    .action-item.high { border-left-color: var(--amber); }
    .action-item.medium { border-left-color: var(--blue); }
    .action-item.low { border-left-color: var(--green); }

    .action-priority {
      font-family: 'DM Mono', monospace;
      font-size: 0.6rem; font-weight: 500;
      letter-spacing: 0.08em; text-transform: uppercase;
      padding: 0.15rem 0.5rem; border-radius: 4px;
      flex-shrink: 0; margin-top: 2px;
    }

    .action-item.critical .action-priority { background: rgba(220,38,38,0.15); color: #fca5a5; }
    .action-item.high .action-priority { background: rgba(217,119,6,0.15); color: #fcd34d; }
    .action-item.medium .action-priority { background: rgba(37,99,235,0.15); color: #93c5fd; }
    .action-item.low .action-priority { background: rgba(5,150,105,0.15); color: #6ee7b7; }

    .action-text { font-size: 0.87rem; color: var(--mist); line-height: 1.5; }
    .action-text strong { color: var(--white); }

    /* compliance table */
    .compliance-table { width: 100%; border-collapse: collapse; }
    .compliance-table th {
      font-family: 'DM Mono', monospace;
      font-size: 0.65rem; letter-spacing: 0.08em; text-transform: uppercase;
      color: var(--steel); text-align: left;
      padding: 0.5rem 0.8rem;
      border-bottom: 1px solid rgba(255,255,255,0.08);
    }
    .compliance-table td {
      font-size: 0.83rem; padding: 0.7rem 0.8rem;
      border-bottom: 1px solid rgba(255,255,255,0.04);
      color: var(--mist); vertical-align: top;
    }
    .compliance-table tr:last-child td { border-bottom: none; }

    .ct-status {
      display: inline-flex; align-items: center; gap: 0.3rem;
      font-family: 'DM Mono', monospace;
      font-size: 0.65rem; font-weight: 500;
      padding: 0.2rem 0.55rem; border-radius: 100px;
    }
    .ct-status.req { background: rgba(220,38,38,0.12); color: #fca5a5; }
    .ct-status.str { background: rgba(217,119,6,0.12); color: #fcd34d; }
    .ct-status.rec { background: rgba(5,150,105,0.12); color: #6ee7b7; }

    /* download area */
    .download-cta {
      background: linear-gradient(135deg, rgba(212,168,67,0.08), rgba(13,148,136,0.08));
      border: 1px solid rgba(212,168,67,0.2);
      border-radius: 14px; padding: 1.8rem;
      text-align: center; margin-top: 1.5rem;
    }

    .download-cta h3 {
      font-family: 'Fraunces', serif;
      font-size: 1.1rem; font-weight: 600; margin-bottom: 0.4rem;
    }

    .download-cta p { font-size: 0.83rem; color: var(--steel); margin-bottom: 1.2rem; }

    .download-cta-btns { display: flex; gap: 0.8rem; justify-content: center; flex-wrap: wrap; }

    /* restart */
    .restart-link {
      text-align: center; margin-top: 1.2rem;
      font-size: 0.8rem; color: var(--steel); cursor: pointer;
      text-decoration: underline; transition: color 0.2s;
    }
    .restart-link:hover { color: var(--mist); }

    /* â”€â”€ ANIMATIONS â”€â”€ */
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(16px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .fade-up { opacity: 0; transform: translateY(20px); transition: opacity 0.5s ease, transform 0.5s ease; }
    .fade-up.vis { opacity: 1; transform: translateY(0); }

    @media (max-width: 640px) {
      .setup-grid { grid-template-columns: 1fr; }
      .score-section { grid-template-columns: 1fr; text-align: center; }
      .score-ring-wrap { margin: 0 auto; }
      .step-item span:last-child { display: none; }
    }
  </style>
</head>
<body>

<header>
  <div class="logo">
    <div class="logo-shield">ğŸ›¡ï¸</div>
    Cyber<span>Safe</span> SME
  </div>
  <div class="header-badge">AI Risk Report Â· Free Â· Worldwide</div>
</header>

<section class="hero">
  <div class="hero-eyebrow">AI-Powered Â· Country-Aware Â· Sector-Specific</div>
  <h1>Your business deserves<br/><em>real</em> cybersecurity advice.</h1>
  <p class="hero-sub">Answer 15 questions. Get a personalised, AI-generated risk report â€” tailored to your country's laws and your industry's threats. Free. Always.</p>
  <div class="hero-pills">
    <span class="pill">ğŸ‡³ğŸ‡¬ Nigeria Â· NDPR</span>
    <span class="pill">ğŸ‡¬ğŸ‡§ UK Â· GDPR + Cyber Essentials</span>
    <span class="pill">ğŸ‡ºğŸ‡¸ USA Â· NIST + State Laws</span>
    <span class="pill">ğŸ¥ Healthcare</span>
    <span class="pill">âš–ï¸ Legal</span>
  </div>
</section>

<div class="tool-wrap">
  <div class="tool-card">

    <!-- STEP BAR -->
    <div class="step-bar" id="stepBar">
      <div class="step-item active" id="sb0">
        <div class="step-dot">1</div>
        <span>Setup</span>
      </div>
      <div class="step-item" id="sb1">
        <div class="step-dot">2</div>
        <span>Questions</span>
      </div>
      <div class="step-item" id="sb2">
        <div class="step-dot">3</div>
        <span>Generating</span>
      </div>
      <div class="step-item" id="sb3">
        <div class="step-dot">4</div>
        <span>Your Report</span>
      </div>
    </div>

    <div class="tool-body" id="toolBody">
      <!-- Injected by JS -->
    </div>
  </div>
</div>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  DATA
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const COUNTRIES = {
  nigeria: {
    name: "Nigeria ğŸ‡³ğŸ‡¬",
    laws: ["NDPR 2019 (NITDA)", "Cybercrimes Act 2015", "NCC Consumer Code"],
    regulator: "NITDA (National Information Technology Development Agency)",
    reportLink: "https://nitda.gov.ng",
    penaltyNote: "Fines up to â‚¦10 million or 2% of annual gross revenue under NDPR",
    sectorNotes: {
      healthcare: "The NDPR classifies health data as sensitive personal data requiring explicit consent. FMOH regulations require patient data confidentiality.",
      legal: "Legal practitioners are bound by the Rules of Professional Conduct and NDPR. Client-attorney privilege extends to digital records."
    }
  },
  uk: {
    name: "United Kingdom ğŸ‡¬ğŸ‡§",
    laws: ["UK GDPR", "Data Protection Act 2018", "Cyber Essentials Scheme", "NIS Regulations 2018"],
    regulator: "Information Commissioner's Office (ICO)",
    reportLink: "https://ico.org.uk",
    penaltyNote: "Fines up to Â£17.5 million or 4% of global annual turnover (whichever is higher)",
    sectorNotes: {
      healthcare: "NHS Data Security standards apply. CQC-regulated practices must demonstrate data security. Mandatory to follow NHS DSPT if processing NHS patient data.",
      legal: "SRA (Solicitors Regulation Authority) requires cyber risk management. Law firms are prime ransomware targets â€” average ransom demand in 2023 was Â£850,000."
    }
  },
  usa: {
    name: "United States ğŸ‡ºğŸ‡¸",
    laws: ["HIPAA (Healthcare)", "State Privacy Laws (CCPA etc.)", "FTC Safeguards Rule", "NIST Cybersecurity Framework"],
    regulator: "FTC, HHS Office for Civil Rights (healthcare), State AGs",
    reportLink: "https://www.hhs.gov/hipaa/index.html",
    penaltyNote: "HIPAA fines from $100 to $50,000 per violation, up to $1.9M per year. State law penalties vary.",
    sectorNotes: {
      healthcare: "HIPAA mandates strict PHI (Protected Health Information) safeguards. Business Associate Agreements required for all vendors. Breach notification within 60 days.",
      legal: "ABA Model Rules require competent cybersecurity. Many state bars mandate breach notification. Law firms hold highly valuable privileged information."
    }
  }
};

const SECTORS = {
  healthcare: {
    name: "Healthcare / Clinic / Pharmacy",
    icon: "ğŸ¥",
    threatProfile: [
      "Ransomware targeting patient records (healthcare is #1 ransomware target globally)",
      "Phishing emails impersonating health authorities (WHO, NCDC, NHS, CDC)",
      "Insider threats â€” unauthorised access to patient records by staff",
      "Unencrypted medical devices connected to your network",
      "Third-party supplier breaches (labs, insurers, referral partners)"
    ]
  },
  legal: {
    name: "Legal / Law Firm",
    icon: "âš–ï¸",
    threatProfile: [
      "Business Email Compromise (BEC) targeting client fund transfers",
      "Ransomware â€” law firms hold irreplaceable privileged documents",
      "Spear phishing targeting partners and senior associates",
      "Confidential document leakage via unsecured email or file sharing",
      "Supply chain attacks via case management software vulnerabilities"
    ]
  }
};

const QUESTIONS = [
  // Passwords & Access
  { cat: "Passwords & Access", q: "How are passwords managed across your business?",
    opts: [
      { t: "We use simple, shared, or reused passwords across accounts", s: 0 },
      { t: "Staff choose their own passwords â€” no enforced policy exists", s: 1 },
      { t: "We have a password policy but it's inconsistently followed", s: 2 },
      { t: "We use a password manager and enforce strong unique passwords for all accounts", s: 3 }
    ]},
  { cat: "Passwords & Access", q: "Is Two-Factor Authentication (2FA) enabled on critical business accounts?",
    opts: [
      { t: "No â€” we haven't set this up on any accounts", s: 0 },
      { t: "Only on personal accounts, not business systems", s: 1 },
      { t: "On some accounts (email or banking) but not all", s: 2 },
      { t: "Yes â€” 2FA is mandatory on all business email, systems, and cloud accounts", s: 3 }
    ]},
  { cat: "Passwords & Access", q: "What happens to staff accounts when an employee leaves?",
    opts: [
      { t: "Nothing â€” their access probably still works", s: 0 },
      { t: "We remove access eventually, but not immediately", s: 1 },
      { t: "We remove access within a few days", s: 2 },
      { t: "All access is revoked on their last day â€” we have a documented offboarding checklist", s: 3 }
    ]},
  // Data Protection
  { cat: "Data & Patient/Client Records", q: "Do you know exactly what personal/patient/client data you hold and where it is stored?",
    opts: [
      { t: "No â€” we have no clear picture of our data", s: 0 },
      { t: "I have a rough idea but nothing is formally documented", s: 1 },
      { t: "We have an informal list but it's not kept up to date", s: 2 },
      { t: "Yes â€” we maintain a documented data register reviewed at least annually", s: 3 }
    ]},
  { cat: "Data & Patient/Client Records", q: "How is sensitive data (patient records / client files) transmitted between staff or to third parties?",
    opts: [
      { t: "By regular email or messaging apps with no encryption", s: 0 },
      { t: "Sometimes securely, sometimes not â€” it depends on the situation", s: 1 },
      { t: "We try to use secure methods but have no formal policy", s: 2 },
      { t: "All sensitive data is encrypted in transit and we have a documented policy", s: 3 }
    ]},
  { cat: "Data & Patient/Client Records", q: "Do you have a documented data breach response procedure?",
    opts: [
      { t: "No â€” we wouldn't know what to do", s: 0 },
      { t: "We know we should report it but have no written plan", s: 1 },
      { t: "We have a rough procedure but it's not formally documented", s: 2 },
      { t: "Yes â€” written procedure, staff are trained on it, regulatory timelines are understood", s: 3 }
    ]},
  // Devices & Network
  { cat: "Devices & Network", q: "Are all devices used in the business kept up to date with security patches?",
    opts: [
      { t: "No â€” updates are often dismissed or delayed", s: 0 },
      { t: "Some devices are updated but not consistently", s: 1 },
      { t: "We update when reminded but there's no automatic system", s: 2 },
      { t: "All devices have automatic updates enabled and are checked regularly", s: 3 }
    ]},
  { cat: "Devices & Network", q: "Is your business Wi-Fi network secured and separated from guest access?",
    opts: [
      { t: "We use a basic router with default settings and one network for everyone", s: 0 },
      { t: "Password protected but patients/clients/guests use the same network as staff", s: 1 },
      { t: "We have guest Wi-Fi but haven't reviewed its security settings", s: 2 },
      { t: "Staff and guest networks are fully separated; router admin password is changed", s: 3 }
    ]},
  // Backups
  { cat: "Backups & Recovery", q: "How frequently is your critical business data backed up?",
    opts: [
      { t: "We don't have a regular backup process", s: 0 },
      { t: "Occasional backups â€” no set schedule", s: 1 },
      { t: "Weekly or monthly â€” but not tested for restoration", s: 2 },
      { t: "Daily automatic backups to a secure off-site or cloud location, regularly tested", s: 3 }
    ]},
  { cat: "Backups & Recovery", q: "If ransomware encrypted all your files today, could you recover your business data?",
    opts: [
      { t: "No â€” we would lose everything or be forced to pay the ransom", s: 0 },
      { t: "Possibly â€” we have some backups but haven't tested them", s: 1 },
      { t: "Probably â€” we have backups but recovery would take days and be incomplete", s: 2 },
      { t: "Yes â€” tested backups mean we could restore fully within hours", s: 3 }
    ]},
  // Staff Awareness
  { cat: "Staff Awareness & Training", q: "Have all staff received cybersecurity awareness training in the last 12 months?",
    opts: [
      { t: "No â€” no training has been provided", s: 0 },
      { t: "Some staff have, informally â€” nothing structured", s: 1 },
      { t: "Training was done once but it's not refreshed regularly", s: 2 },
      { t: "All staff complete structured annual training with records kept", s: 3 }
    ]},
  { cat: "Staff Awareness & Training", q: "Does your team know how to identify and report a phishing email?",
    opts: [
      { t: "No â€” this has never been discussed", s: 0 },
      { t: "Informally â€” some staff know to be careful but have no process", s: 1 },
      { t: "Most staff know the warning signs but have no formal reporting procedure", s: 2 },
      { t: "Yes â€” all staff trained; clear reporting procedure exists and is followed", s: 3 }
    ]},
  // Compliance
  { cat: "Compliance & Governance", q: "Does your business have written security policies (e.g. acceptable use, BYOD, data handling)?",
    opts: [
      { t: "No â€” nothing is documented", s: 0 },
      { t: "Informal rules exist but nothing is written down", s: 1 },
      { t: "We have some policies but staff haven't been formally trained on them", s: 2 },
      { t: "Documented policies exist, reviewed annually, and all staff have signed them", s: 3 }
    ]},
  { cat: "Compliance & Governance", q: "Do you have Data Processing Agreements with all third-party suppliers who handle your client/patient data?",
    opts: [
      { t: "No â€” we haven't considered this", s: 0 },
      { t: "I'm not sure â€” we haven't checked", s: 1 },
      { t: "Some suppliers have agreements but not all", s: 2 },
      { t: "Yes â€” all suppliers handling personal data have signed DPAs", s: 3 }
    ]},
  { cat: "Compliance & Governance", q: "Has your business ever conducted a formal cyber risk assessment or security audit?",
    opts: [
      { t: "Never", s: 0 },
      { t: "Not formally â€” we've had informal conversations about it", s: 1 },
      { t: "Once â€” but not reviewed since", s: 2 },
      { t: "Yes â€” conducted regularly (at least annually) with documented findings", s: 3 }
    ]}
];

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  STATE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let state = {
  step: 0,        // 0=setup, 1=questions, 2=generating, 3=report
  country: '',
  sector: '',
  bizName: '',
  qIndex: 0,
  answers: new Array(QUESTIONS.length).fill(null),
  reportData: null
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  STEP BAR
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateStepBar(active) {
  for (let i = 0; i < 4; i++) {
    const el = document.getElementById('sb' + i);
    el.className = 'step-item';
    if (i < active) el.classList.add('done');
    else if (i === active) el.classList.add('active');
    const dot = el.querySelector('.step-dot');
    dot.textContent = i < active ? 'âœ“' : (i + 1);
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  STEP 0 â€” SETUP
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderSetup() {
  updateStepBar(0);
  document.getElementById('toolBody').innerHTML = `
    <div style="margin-bottom:1.5rem">
      <h2 style="font-family:'Fraunces',serif;font-size:1.4rem;font-weight:600;margin-bottom:0.4rem">Tell us about your business</h2>
      <p style="font-size:0.85rem;color:var(--steel)">This personalises every recommendation in your report to your country's laws and your industry's specific threats.</p>
    </div>
    <div class="setup-grid">
      <div class="field-group">
        <label class="field-label">Your Country</label>
        <div class="select-wrap">
          <select class="field-select" id="selCountry" onchange="state.country=this.value;checkSetup()">
            <option value="">Select country...</option>
            <option value="nigeria">Nigeria ğŸ‡³ğŸ‡¬</option>
            <option value="uk">United Kingdom ğŸ‡¬ğŸ‡§</option>
            <option value="usa">United States ğŸ‡ºğŸ‡¸</option>
          </select>
        </div>
      </div>
      <div class="field-group">
        <label class="field-label">Business Sector</label>
        <div class="select-wrap">
          <select class="field-select" id="selSector" onchange="state.sector=this.value;checkSetup()">
            <option value="">Select sector...</option>
            <option value="healthcare">Healthcare / Clinic / Pharmacy ğŸ¥</option>
            <option value="legal">Legal / Law Firm âš–ï¸</option>
          </select>
        </div>
      </div>
      <div class="field-group" style="grid-column:1/-1">
        <label class="field-label">Business Name <span style="color:var(--steel);font-weight:400;text-transform:none;letter-spacing:0">(optional â€” used in your report)</span></label>
        <input class="field-input" id="inpBizName" type="text" placeholder="e.g. Sunshine Dental Clinic"
          oninput="state.bizName=this.value"/>
      </div>
    </div>

    <div id="sectorPreview" style="display:none;margin-bottom:1.5rem"></div>

    <div class="tool-nav">
      <div style="font-size:0.8rem;color:var(--steel)">15 questions Â· ~8 minutes Â· Free report</div>
      <button class="btn btn-gold" id="btnStart" onclick="goToQuestions()" disabled>
        Start Assessment â†’
      </button>
    </div>
  `;
}

function checkSetup() {
  const btn = document.getElementById('btnStart');
  const prev = document.getElementById('sectorPreview');
  btn.disabled = !(state.country && state.sector);

  if (state.country && state.sector) {
    const c = COUNTRIES[state.country];
    const s = SECTORS[state.sector];
    prev.style.display = 'block';
    prev.innerHTML = `
      <div style="background:var(--ink3);border:1px solid rgba(255,255,255,0.06);border-radius:10px;padding:1.2rem">
        <div style="font-family:'DM Mono',monospace;font-size:0.65rem;letter-spacing:0.1em;text-transform:uppercase;color:var(--teal-light);margin-bottom:0.6rem">
          Your report will cover
        </div>
        <div style="display:flex;flex-wrap:wrap;gap:0.5rem">
          ${c.laws.map(l => `<span style="font-size:0.75rem;padding:0.2rem 0.6rem;border-radius:100px;background:rgba(212,168,67,0.1);border:1px solid rgba(212,168,67,0.2);color:var(--gold-light)">${l}</span>`).join('')}
          <span style="font-size:0.75rem;padding:0.2rem 0.6rem;border-radius:100px;background:rgba(13,148,136,0.1);border:1px solid rgba(13,148,136,0.2);color:var(--teal-light)">${s.icon} ${s.name} threats</span>
        </div>
      </div>
    `;
  } else {
    prev.style.display = 'none';
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  STEP 1 â€” QUESTIONS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function goToQuestions() {
  state.step = 1; state.qIndex = 0;
  renderQuestion();
}

function renderQuestion() {
  updateStepBar(1);
  const q = QUESTIONS[state.qIndex];
  const pct = ((state.qIndex + 1) / QUESTIONS.length) * 100;
  const answered = state.answers[state.qIndex];

  document.getElementById('toolBody').innerHTML = `
    <div class="q-header">
      <div class="q-counter">${state.qIndex + 1} / ${QUESTIONS.length}</div>
      <div class="q-progress-wrap">
        <div class="q-progress-fill" style="width:${pct}%"></div>
      </div>
    </div>
    <div class="q-category">${q.cat}</div>
    <div class="q-text">${q.q}</div>
    <div class="q-options">
      ${q.opts.map((o, i) => `
        <div class="q-opt ${answered === i ? 'selected' : ''}" onclick="selectOpt(${i})">
          <div class="q-opt-indicator"></div>
          <div class="q-opt-text">${o.t}</div>
          <div class="q-opt-score">${o.s}/3</div>
        </div>
      `).join('')}
    </div>
    <div class="tool-nav">
      <button class="btn btn-ghost" onclick="prevQ()" ${state.qIndex === 0 ? 'disabled' : ''}>â† Back</button>
      <button class="btn btn-gold" id="btnNext" onclick="nextQ()" ${answered === null ? 'disabled' : ''}>
        ${state.qIndex === QUESTIONS.length - 1 ? 'Generate My Report â†’' : 'Next â†’'}
      </button>
    </div>
  `;
}

function selectOpt(i) {
  state.answers[state.qIndex] = i;
  renderQuestion();
}

function prevQ() {
  if (state.qIndex > 0) { state.qIndex--; renderQuestion(); }
}

function nextQ() {
  if (state.answers[state.qIndex] === null) return;
  if (state.qIndex < QUESTIONS.length - 1) { state.qIndex++; renderQuestion(); }
  else generateReport();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  STEP 2 â€” GENERATING (AI call)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function generateReport() {
  updateStepBar(2);
  const logs = [
    '> Analysing 15 assessment responses...',
    '> Calculating risk score by category...',
    '> Loading country compliance framework...',
    '> Matching sector-specific threat profile...',
    '> AI generating personalised analysis...',
    '> Compiling action plan by priority...',
    '> Finalising your report...'
  ];

  document.getElementById('toolBody').innerHTML = `
    <div class="generating-wrap">
      <div class="gen-spinner"></div>
      <div class="gen-title">Building your personalised report...</div>
      <div class="gen-sub">This usually takes 15â€“30 seconds</div>
      <div class="gen-log" id="genLog"></div>
    </div>
  `;

  const logEl = document.getElementById('genLog');
  for (let i = 0; i < logs.length; i++) {
    await delay(600 + Math.random() * 400);
    logEl.innerHTML += logs[i] + '\n';
  }

  // Calculate scores
  const total = state.answers.reduce((sum, a, i) => sum + (a !== null ? QUESTIONS[i].opts[a].s : 0), 0);
  const maxScore = QUESTIONS.length * 3;
  const pct = Math.round((total / maxScore) * 100);

  // Category scores
  const cats = {};
  QUESTIONS.forEach((q, i) => {
    if (!cats[q.cat]) cats[q.cat] = { got: 0, max: 0, count: 0 };
    cats[q.cat].got += (state.answers[i] !== null ? q.opts[state.answers[i]].s : 0);
    cats[q.cat].max += 3;
    cats[q.cat].count++;
  });

  // Find weakest categories (score < 50%)
  const weakCats = Object.entries(cats)
    .filter(([, v]) => v.got / v.max < 0.5)
    .map(([k]) => k);

  // Build AI prompt
  const c = COUNTRIES[state.country];
  const s = SECTORS[state.sector];
  const bizLabel = state.bizName || `a ${s.name} in ${c.name}`;
  const catBreakdown = Object.entries(cats)
    .map(([k, v]) => `${k}: ${v.got}/${v.max} (${Math.round(v.got/v.max*100)}%)`)
    .join(', ');

  const prompt = `You are a senior GRC (Governance, Risk, and Compliance) cybersecurity consultant writing a professional cyber risk report for a small business client.

Business: ${bizLabel}
Country: ${c.name}
Applicable Laws: ${c.laws.join(', ')}
Regulatory Penalty Note: ${c.penaltyNote}
Sector-specific regulatory context: ${c.sectorNotes[state.sector]}

Overall Risk Score: ${pct}% (${total}/${maxScore} points)
Category breakdown: ${catBreakdown}
Weakest areas: ${weakCats.join(', ') || 'None â€” solid across the board'}

Sector threat profile: ${s.threatProfile.join('; ')}

Write a professional, personalised cyber risk report with these EXACT sections in this EXACT JSON format. Be specific, practical, and authoritative. Reference the actual laws and regulations that apply. Mention real tools (free ones preferred). Be direct â€” this is a consultant speaking to a business owner, not generic advice.

Return ONLY valid JSON, no markdown, no backticks:
{
  "executiveSummary": "3-4 sentences. Summarise the overall risk posture, the single biggest concern, and what the business should prioritise. Reference the actual country laws and sector risks. Be direct and specific.",
  "riskLevel": "Critical|High|Moderate|Good|Strong",
  "keyFindings": [
    {"priority": "critical|high|medium|low", "title": "Short finding title", "detail": "2-3 sentences explaining the specific risk, what could go wrong, and the regulatory consequence for this country and sector."}
  ],
  "actionPlan": [
    {"priority": "critical|high|medium|low", "action": "Specific actionable step", "detail": "How to do it, with free tool recommendations where applicable. Reference relevant law or standard."}
  ],
  "complianceStatus": [
    {"regulation": "Name of law/standard", "status": "required|strong|recommended", "note": "1 sentence on current likely status and what's needed"}
  ],
  "sectorAlert": "2-3 sentences on the most dangerous sector-specific threat this type of business faces right now, with a real recent example or statistic."
}

Generate at least 4 keyFindings and 6 actionPlan items. Make the content highly specific to ${c.name} ${s.name} businesses.`;

  try {
    const response = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: 'claude-sonnet-4-20250514',
        max_tokens: 1000,
        messages: [{ role: 'user', content: prompt }]
      })
    });

    const data = await response.json();
    const raw = data.content.map(b => b.text || '').join('');
    const cleaned = raw.replace(/```json|```/g, '').trim();
    const parsed = JSON.parse(cleaned);

    state.reportData = { ...parsed, score: pct, total, maxScore, cats, weakCats, c, s };
    renderReport();

  } catch (err) {
    // Fallback report if API fails
    state.reportData = buildFallbackReport(pct, total, maxScore, cats, weakCats);
    renderReport();
  }
}

function buildFallbackReport(pct, total, maxScore, cats, weakCats) {
  const c = COUNTRIES[state.country];
  const s = SECTORS[state.sector];
  const level = pct >= 75 ? 'Good' : pct >= 50 ? 'Moderate' : pct >= 25 ? 'High' : 'Critical';

  return {
    score: pct, total, maxScore, cats, weakCats, c, s,
    riskLevel: level,
    executiveSummary: `This ${s.name} has a cyber risk score of ${pct}% â€” rated ${level}. ${weakCats.length > 0 ? `The most urgent gaps are in: ${weakCats.join(' and ')}.` : 'The business shows a reasonable security baseline.'} Given the sensitivity of ${state.sector === 'healthcare' ? 'patient health data' : 'client legal files'} and the requirements of ${c.laws[0]}, immediate action is recommended on the priority items below.`,
    keyFindings: [
      { priority: "critical", title: "Data breach response plan missing or inadequate", detail: `Under ${c.laws[0]}, you are required to report certain data breaches to ${c.regulator} within a defined timeframe. Without a documented response plan, your business risks regulatory fines and reputational damage. ${c.penaltyNote}.` },
      { priority: "high", title: "Staff awareness training insufficient", detail: `Over 80% of cyberattacks begin with a human mistake â€” usually a phishing email. ${s.name} businesses are frequently targeted with sector-specific lures. Without regular staff training, one click could expose all your ${state.sector === 'healthcare' ? 'patient records' : 'client files'}.` },
      { priority: "high", title: "Weak password and access controls", detail: "Shared or weak passwords remain the leading cause of business account takeover. Without a password manager and 2FA, all your business accounts â€” email, cloud storage, practice management software â€” are vulnerable to credential attacks." },
      { priority: "medium", title: "Backup and recovery capability untested", detail: "Ransomware attacks on healthcare and legal firms more than doubled in the last two years. An untested backup is not a real backup. If you cannot restore your data within hours, your business continuity is at serious risk." }
    ],
    actionPlan: [
      { priority: "critical", action: "Enable 2FA on all email and cloud accounts today", detail: "Use Google Authenticator or Microsoft Authenticator â€” both free. This single step blocks over 99% of automated account takeover attacks. Do this before anything else." },
      { priority: "critical", action: "Document your data breach response procedure", detail: `Write a one-page plan covering: who leads the response, how to contain the breach, who to notify (${c.regulator}), and within what timeframe. Keep it accessible to all senior staff.` },
      { priority: "high", action: "Deploy a password manager across all staff accounts", detail: "Bitwarden offers a free plan for individuals and affordable team plans. Require all staff to use unique 12+ character passwords for every business account." },
      { priority: "high", action: "Run staff phishing awareness training", detail: "Use the free SME Security Shield training modules (smesecurityshield.com). Focus on phishing and social engineering â€” the two highest-risk attack vectors for your sector." },
      { priority: "high", action: "Set up automatic daily backups to an off-site location", detail: "Use a cloud backup solution (Google Workspace Backup, Microsoft 365 Backup, or Acronis). Test restoration quarterly. A backup you can't restore from is worthless." },
      { priority: "medium", action: `Review compliance with ${c.laws[0]}`, detail: `Visit ${c.reportLink} for free SME guidance. Ensure you have a current Privacy Notice, know your lawful basis for processing ${state.sector === 'healthcare' ? 'patient' : 'client'} data, and have Data Processing Agreements with all suppliers.` }
    ],
    complianceStatus: c.laws.map((law, i) => ({
      regulation: law,
      status: i === 0 ? 'required' : i === 1 ? 'strong' : 'recommended',
      note: `Review your current compliance position against ${law} requirements as a priority.`
    })),
    sectorAlert: `${s.name} businesses are among the most targeted by cybercriminals worldwide. ${s.threatProfile[0]}. In 2023, the average cost of a data breach for a healthcare or legal SME exceeded $150,000 when including regulatory fines, legal costs, and reputational damage â€” far more than the cost of prevention.`
  };
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  STEP 3 â€” REPORT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderReport() {
  updateStepBar(3);
  const d = state.reportData;
  const pct = d.score;
  const bizLabel = state.bizName || `Your ${d.s.name}`;

  // Colours
  const scoreColor = pct >= 75 ? '#059669' : pct >= 50 ? '#2563eb' : pct >= 25 ? '#d97706' : '#dc2626';
  const riskColors = { Critical: '#dc2626', High: '#d97706', Moderate: '#2563eb', Good: '#059669', Strong: '#0d9488' };
  const riskBgs = { Critical: 'rgba(220,38,38,0.12)', High: 'rgba(217,119,6,0.12)', Moderate: 'rgba(37,99,235,0.12)', Good: 'rgba(5,150,105,0.12)', Strong: 'rgba(13,148,136,0.12)' };

  const circumference = 2 * Math.PI * 48;
  const dashOffset = circumference - (pct / 100) * circumference;

  // Category bars
  const catBars = Object.entries(d.cats).map(([k, v]) => {
    const cpct = Math.round(v.got / v.max * 100);
    const barColor = cpct >= 67 ? '#059669' : cpct >= 34 ? '#d97706' : '#dc2626';
    return `
      <div style="margin-bottom:0.7rem">
        <div style="display:flex;justify-content:space-between;margin-bottom:0.3rem">
          <span style="font-size:0.78rem;color:var(--mist)">${k}</span>
          <span style="font-family:'DM Mono',monospace;font-size:0.72rem;color:var(--steel)">${v.got}/${v.max}</span>
        </div>
        <div style="height:5px;background:rgba(255,255,255,0.07);border-radius:100px;overflow:hidden">
          <div style="height:100%;width:${cpct}%;background:${barColor};border-radius:100px;transition:width 1s ease"></div>
        </div>
      </div>
    `;
  }).join('');

  // Findings
  const findingIcons = { critical: 'ğŸ”´', high: 'ğŸŸ ', medium: 'ğŸ”µ', low: 'ğŸŸ¢' };
  const findingsHtml = (d.keyFindings || []).map(f => `
    <div class="action-item ${f.priority}">
      <span class="action-priority">${f.priority}</span>
      <div class="action-text"><strong>${f.title}</strong><br/>${f.detail}</div>
    </div>
  `).join('');

  // Actions
  const actionsHtml = (d.actionPlan || []).map(a => `
    <div class="action-item ${a.priority}">
      <span class="action-priority">${a.priority}</span>
      <div class="action-text"><strong>${a.action}</strong><br/>${a.detail}</div>
    </div>
  `).join('');

  // Compliance
  const complianceHtml = (d.complianceStatus || []).map(r => `
    <tr>
      <td><strong>${r.regulation}</strong></td>
      <td><span class="ct-status ${r.status === 'required' ? 'req' : r.status === 'strong' ? 'str' : 'rec'}">${r.status}</span></td>
      <td>${r.note}</td>
    </tr>
  `).join('');

  const now = new Date().toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' });

  document.getElementById('toolBody').innerHTML = `
    <div class="report-toolbar">
      <div class="report-title-area">
        <h2>${bizLabel} â€” Cyber Risk Report</h2>
        <p>${d.s.icon} ${d.s.name} Â· ${d.c.name} Â· Generated ${now}</p>
      </div>
      <div class="report-actions">
        <button class="btn btn-ghost" onclick="window.print()" style="font-size:0.82rem;padding:0.55rem 1rem">ğŸ–¨ Print</button>
      </div>
    </div>

    <!-- Score -->
    <div class="score-section">
      <div class="score-ring-wrap">
        <svg viewBox="0 0 110 110" width="120" height="120">
          <circle class="score-ring-bg" cx="55" cy="55" r="48"/>
          <circle class="score-ring-fill" cx="55" cy="55" r="48"
            stroke="${scoreColor}"
            stroke-dasharray="${circumference}"
            stroke-dashoffset="${dashOffset}"/>
        </svg>
        <div class="score-num">
          <div class="score-num-val" style="color:${scoreColor}">${pct}%</div>
          <div class="score-num-label">Score</div>
        </div>
      </div>
      <div class="score-info">
        <span class="risk-badge" style="background:${riskBgs[d.riskLevel]};color:${riskColors[d.riskLevel]};border:1px solid ${riskColors[d.riskLevel]}40">
          ${d.riskLevel} Risk
        </span>
        <h3 style="color:${scoreColor}">${pct >= 75 ? 'Strong Foundation' : pct >= 50 ? 'Moderate Risk' : pct >= 25 ? 'High Risk' : 'Critical â€” Immediate Action Needed'}</h3>
        <p>${d.executiveSummary}</p>
      </div>
    </div>

    <!-- Category Breakdown -->
    <div class="report-section">
      <div class="report-section-header">
        <div class="report-section-icon" style="background:rgba(212,168,67,0.12);border:1px solid rgba(212,168,67,0.2)">ğŸ“Š</div>
        <div>
          <div class="report-section-title">Score by Category</div>
          <div class="report-section-sub">Where your business is strong and where attention is needed</div>
        </div>
      </div>
      ${catBars}
    </div>

    <!-- Sector Alert -->
    <div class="report-section" style="border-color:rgba(220,38,38,0.2);background:rgba(220,38,38,0.04)">
      <div class="report-section-header">
        <div class="report-section-icon" style="background:rgba(220,38,38,0.12);border:1px solid rgba(220,38,38,0.2)">âš ï¸</div>
        <div>
          <div class="report-section-title">Sector Threat Alert</div>
          <div class="report-section-sub">The biggest cyber threats facing ${d.s.name} businesses right now</div>
        </div>
      </div>
      <p class="report-text">${d.sectorAlert}</p>
      <div style="display:flex;flex-wrap:wrap;gap:0.5rem">
        ${d.s.threatProfile.map(t => `<span style="font-size:0.75rem;padding:0.22rem 0.65rem;border-radius:100px;background:rgba(220,38,38,0.08);border:1px solid rgba(220,38,38,0.15);color:#fca5a5">${t}</span>`).join('')}
      </div>
    </div>

    <!-- Key Findings -->
    <div class="report-section">
      <div class="report-section-header">
        <div class="report-section-icon" style="background:rgba(37,99,235,0.12);border:1px solid rgba(37,99,235,0.2)">ğŸ”</div>
        <div>
          <div class="report-section-title">Key Findings</div>
          <div class="report-section-sub">Issues identified that require your attention</div>
        </div>
      </div>
      <div class="action-list">${findingsHtml}</div>
    </div>

    <!-- Action Plan -->
    <div class="report-section">
      <div class="report-section-header">
        <div class="report-section-icon" style="background:rgba(13,148,136,0.12);border:1px solid rgba(13,148,136,0.2)">âœ…</div>
        <div>
          <div class="report-section-title">Your Prioritised Action Plan</div>
          <div class="report-section-sub">What to do, in order of urgency</div>
        </div>
      </div>
      <div class="action-list">${actionsHtml}</div>
    </div>

    <!-- Compliance -->
    <div class="report-section">
      <div class="report-section-header">
        <div class="report-section-icon" style="background:rgba(212,168,67,0.12);border:1px solid rgba(212,168,67,0.2)">âš–ï¸</div>
        <div>
          <div class="report-section-title">Compliance Framework</div>
          <div class="report-section-sub">Laws and standards applicable to your business in ${d.c.name}</div>
        </div>
      </div>
      <table class="compliance-table">
        <thead>
          <tr>
            <th>Regulation / Standard</th>
            <th>Obligation Level</th>
            <th>Note</th>
          </tr>
        </thead>
        <tbody>${complianceHtml}</tbody>
      </table>
      <p style="font-size:0.78rem;color:var(--steel);margin-top:0.8rem">
        Enforced by: ${d.c.regulator} Â· <a href="${d.c.reportLink}" target="_blank" style="color:var(--teal-light)">${d.c.reportLink}</a>
      </p>
    </div>

    <!-- Download CTA -->
    <div class="download-cta">
      <h3>Get the full SME Security Shield toolkit</h3>
      <p>Free documents to act on every finding in this report â€” risk assessment, staff training, and compliance checklist.</p>
      <div class="download-cta-btns">
        <a href="https://smesecurityshield.com" target="_blank" class="btn btn-gold">Download Free Toolkit â†’</a>
        <button class="btn btn-ghost" onclick="window.print()">ğŸ–¨ Print This Report</button>
      </div>
    </div>

    <div class="restart-link" onclick="restartTool()">â† Start a new assessment</div>
  `;
}

function restartTool() {
  state = { step: 0, country: '', sector: '', bizName: '', qIndex: 0, answers: new Array(QUESTIONS.length).fill(null), reportData: null };
  renderSetup();
}

function delay(ms) { return new Promise(r => setTimeout(r, ms)); }

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  INIT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
renderSetup();

// scroll fade
const obs = new IntersectionObserver(entries => {
  entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('vis'); });
}, { threshold: 0.08 });
document.querySelectorAll('.fade-up').forEach(el => obs.observe(el));
</script>

</body>
</html>
